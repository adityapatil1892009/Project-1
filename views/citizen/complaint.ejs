<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head') %>
<body>
    <%- include('../partials/header') %>
    <%- include('../partials/navbar') %>

    <main class="container" style="padding: 40px 20px; max-width: 900px; margin: 0 auto;">
        <!-- Page Header -->
        <div style="margin-bottom: 40px; text-align: center;">
            <h2 style="color: var(--primary-blue); font-size: 2.2em; margin-bottom: 10px;">Report an Issue</h2>
            <p style="color: #666; font-size: 1.1em;">We're here to help. Submit your complaint and we'll prioritize resolution.</p>
        </div>

        <!-- Support Info Bar -->
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 20px; border-radius: 8px; margin-bottom: 30px; display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
            <div style="text-align: center;">
                <div style="font-size: 1.5em; margin-bottom: 5px;">ğŸ“</div>
                <strong style="display: block; color: var(--primary-blue);">24/7 Support</strong>
                <small>Call: 1800-WATER-101</small>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 1.5em; margin-bottom: 5px;">âš¡</div>
                <strong style="display: block; color: var(--primary-blue);">Quick Response</strong>
                <small>Avg 2 min response time</small>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 1.5em; margin-bottom: 5px;">âœ“</div>
                <strong style="display: block; color: var(--primary-blue);">Real-time Tracking</strong>
                <small>Monitor your complaint status</small>
            </div>
        </div>

        <!-- Main Form Section -->
        <div class="content-box" style="background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 15px rgba(0,0,0,0.08);">
            <form id="complaintForm">
                <!-- Personal Information -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 15px; font-size: 1.1em;">ğŸ“‹ Your Information</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Consumer Number *</label>
                            <input name="consumerNumber" type="text" placeholder="e.g., WS123456" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Phone Number *</label>
                            <input name="phone" type="tel" placeholder="e.g., 98765-43210" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em;">
                        </div>
                    </div>
                </div>

                <!-- Issue Details -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 15px; font-size: 1.1em;">âš ï¸ Issue Details</h3>
                    
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Issue Type *</label>
                        <select name="issueType" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em;">
                            <option value="">-- Select Issue Type --</option>
                            <option value="no-water">âŒ No Water Supply</option>
                            <option value="low-pressure">ğŸ“‰ Low Pressure</option>
                            <option value="contaminated">ğŸš« Contaminated Water</option>
                            <option value="leakage">ğŸ’§ Pipeline Leakage</option>
                            <option value="billing">ğŸ’° Billing Issue</option>
                            <option value="meter">ğŸ“Š Meter Problem</option>
                            <option value="other">ğŸ“ Other</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Severity Level *</label>
                        <select name="severity" required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em;">
                            <option value="">-- Select Severity --</option>
                            <option value="low">ğŸŸ¢ Low - Can Wait</option>
                            <option value="medium">ğŸŸ¡ Medium - Urgent</option>
                            <option value="high">ğŸ”´ High - Critical</option>
                        </select>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #333;">Description *</label>
                        <textarea name="description" rows="5" placeholder="Please describe your issue in detail. Include location, when it started, and any photos/evidence if available." required style="width: 100%; padding: 12px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 1em; resize: vertical;"></textarea>
                    </div>
                </div>

                <!-- Additional Options -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary-blue); margin-bottom: 15px; font-size: 1.1em;">ğŸ“¸ Attachments (Optional)</h3>
                    <div style="border: 2px dashed #2196F3; padding: 20px; border-radius: 6px; text-align: center; cursor: pointer; background: #f5f5f5;">
                        <div style="font-size: 2em; margin-bottom: 10px;">ğŸ“·</div>
                        <p style="margin: 0; color: #666;">Click to upload photos or documents</p>
                        <small style="color: #999;">JPG, PNG, PDF up to 5MB each</small>
                        <input type="file" multiple style="display: none;">
                    </div>
                </div>

                <!-- Consent & Submit -->
                <div style="margin-bottom: 20px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" required style="width: 18px; height: 18px;">
                        <span>I authorize the municipality to contact me regarding this complaint</span>
                    </label>
                </div>

                <button type="button" onclick="submitComplaint()" style="width: 100%; padding: 14px; background: var(--primary-blue); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1.1em; font-weight: 600; transition: background 0.3s;">Register Complaint</button>
            </form>
        </div>

        <!-- Recent Complaints Info -->
        <div style="margin-top: 40px; padding: 20px; background: #f9f9f9; border-left: 4px solid var(--primary-blue); border-radius: 6px;">
            <h4 style="margin-top: 0; color: var(--primary-blue);">âœ“ What Happens Next?</h4>
            <ol style="margin: 15px 0; padding-left: 20px; line-height: 1.8;">
                <li>Your complaint is registered with a unique Reference ID</li>
                <li>Our team reviews and prioritizes based on severity</li>
                <li>You receive instant SMS/Email confirmation</li>
                <li>Real-time status updates on your complaint page</li>
                <li>Direct communication with assigned technician</li>
            </ol>
        </div>
    </main>

    <%- include('../partials/footer') %>

    <script>
        async function submitComplaint() {
            const form = document.getElementById('complaintForm');
            if (!form.checkValidity()) {
                alert('Please fill all required fields marked with *');
                return;
            }
            const data = {
                consumerNumber: form.consumerNumber.value || '',
                phone: form.phone.value || '',
                name: form.name ? form.name.value : '',
                issueType: form.issueType.value,
                severity: form.severity.value,
                description: form.description.value
            };

            try {
                const res = await fetch('/citizen/complaint/submit', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Accept': 'application/json' },
                    body: JSON.stringify(data)
                });
                const json = await res.json();
                if (res.ok && json.ok) {
                    alert(`âœ“ Complaint Registered Successfully!\n\nReference ID: ${json.reference}\n\nYou will receive updates via SMS and Email.`);
                    form.reset();
                } else {
                    alert(json.error || 'Failed to register complaint');
                }
            } catch (err) {
                console.error(err);
                alert('Server error, please try again later.');
            }
        }
    </script>
</body>
</html>